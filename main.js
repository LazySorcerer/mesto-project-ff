(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-31",headers:{authorization:"4f931946-ca14-49b5-a514-3e8b3eafd8f1","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))};function n(e){var t=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),n=t.querySelector(".card__image");t.querySelector(".card__title").textContent=e.card.name,n.src=e.card.link,n.alt=e.card.name;var o=t.querySelector(".card__delete-button");e.card.owner._id===e.userId||null==e.userId?o.addEventListener("click",(function(t){return e.deleteCard(t,e.card._id)})):o.style.display="none";var r=t.querySelector(".card__like-button");e.card.likes.some((function(t){return t._id===e.userId}))&&r.classList.add("card__like-button_is-active"),r.addEventListener("click",(function(t){return e.likeCard(t,e.card._id,r,c)}));var c=t.querySelector(".card__like-counter");return c.textContent=e.card.likes.length,n.addEventListener("click",e.openImage),t}var o=function(n,o){var r=n.target.closest(".card");(function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers})})(o).then(t).then((function(e){r.remove()})).catch((function(e){console.log(e)}))},r=function(n,o,r,c){n.target.classList.contains("card__like-button")&&(n.target.classList.contains("card__like-button_is-active")?function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers})}(o).then(t).then((function(e){r.classList.remove("card__like-button_is-active"),c.textContent=e.likes.length})).catch((function(e){console.log(e)})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers})}(o).then(t).then((function(e){r.classList.add("card__like-button_is-active"),c.textContent=e.likes.length})).catch((function(e){console.log(e)})))},c=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");i(t)}};function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}var i=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)},s=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},u=function(e,t){if(null!=t.inputErrorSelector&&e.querySelectorAll(t.inputErrorSelector).forEach((function(e){e.classList.remove(t.inputErrorSelector.slice(1))})),null!=t.errorSelector&&e.querySelectorAll(t.errorSelector).forEach((function(e){e.classList.remove(t.errorSelector.slice(1))})),null!=t.submitButtonSelector){var n=e.querySelector(t.submitButtonSelector);n.disabled=!0,n.classList.add(t.inactiveButtonClass)}},l=document.querySelector(".profile__edit-button"),d=document.querySelector(".profile__add-button"),p=document.querySelector(".popup_type_edit"),f=document.querySelector(".popup_type_new-card"),m=document.querySelector(".popup_type_image"),_=document.querySelector(".popup__image"),v=document.querySelector(".popup__caption"),y=document.querySelector(".popup_type_avatar"),h=document.querySelector(".profile__image"),S=document.forms["edit-profile"],b=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),L=document.forms["new-place"],g=document.querySelector(".places__list"),E=document.querySelectorAll(".popup"),k=document.querySelector(".profile__image-edit_icon-wrapper"),q=document.querySelector(".profile__image-edit_icon"),x=document.forms["edit-avatar"],B=document.querySelector(".popup__button");E.forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&i(e),t.target.classList.contains("popup__close")&&i(e)}))})),l.addEventListener("click",(function(){u(p,{inputErrorSelector:".popup__input_type_error",errorSelector:".popup__error_visible"}),a(p),S.elements.name.value=b.textContent,S.elements.description.value=C.textContent})),d.addEventListener("click",(function(){a(f)})),S.addEventListener("submit",(function(n){var o,r;n.preventDefault(),B.textContent="Сохранение...",(o=S.elements.name.value,r=S.elements.description.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})})).then(t).then((function(e){b.textContent=e.name,C.textContent=e.about,i(p)})).catch((function(e){console.log(e)})).finally((function(){B.textContent="Сохранить"}))}));var U,A=function(e){var t=e.currentTarget.src,n=e.currentTarget.alt;a(m),_.src=t,_.alt=n,v.textContent=n};L.addEventListener("submit",(function(c){c.preventDefault();var a=L.elements["place-name"].value,s=L.elements.link.value;B.textContent="Сохранение...",function(t,n){return fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:t,link:n})})}(a,s).then(t).then((function(e){g.prepend(n({card:e,deleteCard:o,likeCard:r,openImage:A})),L.reset(),i(f),u(f,{submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"})})).catch((function(e){console.log(e)})).finally((function(){B.textContent="Сохранить"}))})),k.addEventListener("click",(function(){a(y)})),k.addEventListener("mouseover",(function(){h.style.opacity="0.2",q.style.display="block"})),k.addEventListener("mouseout",(function(){h.style.opacity="1",q.style.display="none"})),x.addEventListener("submit",(function(n){var o;n.preventDefault(),B.textContent="Сохранение...",(o=x.elements.link.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})})).then(t).then((function(e){h.style.backgroundImage="url(".concat(e.avatar,")"),i(y)})).catch((function(e){console.log(e)})).finally((function(){B.textContent="Сохранить"}))})),U={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(U.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);s(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),s(n,o,t)}))}))}(e,U)})),Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t)]).then((function(e){var t,c;b.textContent=e[0].name,C.textContent=e[0].about,h.style.backgroundImage="url(".concat(e[0].avatar,")"),t=e[1],c=e[0]._id,t.forEach((function(e){g.append(n({userId:c,card:e,deleteCard:o,likeCard:r,openImage:A}))}))})).catch((function(e){console.log(e)}))})();